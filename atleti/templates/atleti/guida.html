{% extends 'base.html' %}

{% block content %}
<div class="container py-4">
    <h1 class="fw-bold mb-4"><i class="bi bi-book-half me-2"></i>Guida Utente & Manuale</h1>
    
    <div class="alert alert-info shadow-sm mb-4">
        <i class="bi bi-info-circle-fill me-2"></i>
        <strong>Aggiornamento 2026:</strong> Gli algoritmi sono stati ricalibrati per offrire una stima pi√π fisiologica. Consulta la sezione "Metriche & Algoritmi".
    </div>

    <div class="accordion shadow-sm" id="guideAccordion">
        
        <!-- 1. Metriche & Algoritmi -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingMetrics">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMetrics" aria-expanded="true" aria-controls="collapseMetrics">
                    <i class="bi bi-calculator me-2"></i> Metriche & Algoritmi (VO2max, VAM, EF)
                </button>
            </h2>
            <div id="collapseMetrics" class="accordion-collapse collapse show" aria-labelledby="headingMetrics" data-bs-parent="#guideAccordion">
                <div class="accordion-body bg-light">
                    <div class="row g-4">
        <!-- VO2max Stima Statistica -->
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-danger text-white fw-bold">
                    <i class="bi bi-heart-pulse me-2"></i>VO2max Stima Statistica (Algoritmo 2026)
                </div>
                <div class="card-body">
                    <p>
                        Il <strong>VO2max Stima Statistica</strong> √® l'indice principale del tuo motore aerobico. 
                        A differenza dei calcoli standard (es. Garmin/Firstbeat) che spesso sovrastimano basandosi solo sulla velocit√† massima, 
                        il nostro algoritmo utilizza la <strong>Riserva Cardiaca (Karvonen)</strong> per valutare quanto "costa" al tuo cuore mantenere un certo passo.
                    </p>
                    
                    <h5 class="fw-bold mt-4 text-secondary">Come viene calcolato?</h5>
                    <ol class="list-group list-group-numbered mb-3">
                        <li class="list-group-item">
                            <strong>Costo Energetico (O2):</strong> Calcoliamo l'ossigeno necessario per correre alla tua velocit√†.
                            <ul>
                                <li><span class="badge bg-primary">Strada</span> Usiamo il <strong>GAP (Grade Adjusted Pace)</strong> per normalizzare le pendenze come se fossi in piano.</li>
                                <li><span class="badge bg-success">Trail</span> Applichiamo la regola dello sforzo equivalente: <strong>100m D+ = 500m piani</strong>.</li>
                            </ul>
                        </li>
                        <li class="list-group-item">
                            <strong>Intensit√† Cardiaca (%HRR):</strong> Confrontiamo la tua FC Media con la tua Riserva Cardiaca (FC Max - FC Riposo).
                            <br><small class="text-muted">Esempio: Se corri a 4:30 min/km al 70% della tua riserva, hai un motore pi√π grande di chi lo fa all'85%.</small>
                        </li>
                        <li class="list-group-item">
                            <strong>Proiezione:</strong> Proiettiamo la prestazione al massimale usando la formula inversa di Karvonen.
                        </li>
                    </ol>

                    <h5 class="fw-bold mt-4 text-secondary">Fattori di Correzione</h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="p-3 bg-light rounded border-start border-4 border-warning">
                                <strong>üê¢ Penalit√† Efficienza</strong><br>
                                Se il passo √® pi√π lento di <strong>5:15 min/km</strong> su strada, applichiamo una riduzione del <strong>5%</strong>. 
                                <br><small>Motivo: A ritmi lenti l'efficienza meccanica cala e la formula lineare tenderebbe a sovrastimare.</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="p-3 bg-light rounded border-start border-4 border-info">
                                <strong>üß¢ Ancoraggio ITRA</strong><br>
                                Usiamo il tuo Indice ITRA come "tetto di realt√†" per evitare valori impossibili.
                                <br><small>ITRA &lt; 500 &rarr; Max 54 | ITRA &lt; 600 &rarr; Max 60</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VO2max Solo Strada -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-primary text-white fw-bold">
                    <i class="bi bi-speedometer2 me-2"></i>VO2max Solo Strada
                </div>
                <div class="card-body">
                    <p>
                        Questa metrica isola solo le attivit√† di tipo <strong>Corsa (Run)</strong>, escludendo Trail e Trekking.
                        √à utile per monitorare la tua efficienza pura sull'asfalto o in pista.
                    </p>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="bi bi-check-lg text-success me-2"></i>Usa la formula ACSM su piano (GAP).</li>
                        <li class="mb-2"><i class="bi bi-check-lg text-success me-2"></i>Include la penalit√† del 5% per passi lenti.</li>
                        <li class="mb-2"><i class="bi bi-check-lg text-success me-2"></i>Media mobile delle ultime 60 sessioni.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- VAM Selettiva -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-warning text-dark fw-bold">
                    <i class="bi bi-graph-up-arrow me-2"></i>VAM Selettiva (Pro)
                </div>
                <div class="card-body">
                    <p>
                        La VAM (Velocit√† Ascensionale Media) classica √® spesso falsata da tratti in piano o discesa.
                        La nostra <strong>VAM Selettiva</strong> analizza la traccia secondo per secondo.
                    </p>
                    <div class="alert alert-warning py-2">
                        <strong>Regola:</strong> Consideriamo solo i segmenti di salita con pendenza <strong>&gt; 7%</strong>.
                    </div>
                    <p class="small text-muted mb-0">
                        Questo ti d√† la tua vera velocit√† di scalata pura, escludendo i "tempi morti".
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Efficienza -->
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-success text-white fw-bold">
                    <i class="bi bi-fuel-pump me-2"></i>Efficiency Factor (EF)
                </div>
                <div class="card-body">
                    <p>
                        L'Efficiency Factor misura il "consumo" del tuo motore. Indica quanti <strong>metri</strong> riesci a percorrere con un singolo <strong>battito cardiaco</strong>.
                    </p>
                    <div class="text-center my-3">
                        <span class="display-6 fw-bold text-success">EF = Velocit√† (m/min) / FC (bpm)</span>
                    </div>
                    <p>
                        <strong>Come interpretarlo?</strong>
                        <br>Se a parit√† di pulsazioni vai pi√π forte, il tuo EF sale. √à il miglior indicatore di miglioramento aerobico nel lungo periodo.
                    </p>
                    <div class="row text-center small text-muted mt-3">
                        <div class="col">Base: &lt; 1.0</div>
                        <div class="col">Buono: 1.2</div>
                        <div class="col">Eccellente: &gt; 1.4</div>
                        <div class="col">Elite: &gt; 1.6</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
                </div>
            </div>
        </div>

        <!-- 2. Manuale Applicazione -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingApp">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseApp" aria-expanded="false" aria-controls="collapseApp">
                    <i class="bi bi-laptop me-2"></i> Manuale Applicazione (Come usare il sito)
                </button>
            </h2>
            <div id="collapseApp" class="accordion-collapse collapse" aria-labelledby="headingApp" data-bs-parent="#guideAccordion">
                <div class="accordion-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <h5 class="fw-bold"><i class="bi bi-speedometer2 me-2"></i>Dashboard Personale</h5>
                            <p>√à la tua home page. Qui trovi il riepilogo del volume (km e dislivello), i grafici di trend recenti e gli allarmi del coach. Usa i pulsanti rapidi per sincronizzare Strava o analizzare i tuoi dati con l'AI.</p>
                        </li>
                        <li class="list-group-item">
                            <h5 class="fw-bold"><i class="bi bi-calendar-event me-2"></i>Allenamenti di Gruppo</h5>
                            <p>In questa sezione puoi vedere gli allenamenti organizzati dal team. Puoi confermare la tua presenza, scaricare la traccia GPX e vedere chi altro partecipa. Se sei l'organizzatore, puoi gestire le adesioni.</p>
                        </li>
                        <li class="list-group-item">
                            <h5 class="fw-bold"><i class="bi bi-people me-2"></i>Riepilogo Atleti</h5>
                            <p>La classifica settimanale del team. Puoi confrontare i tuoi volumi e dislivelli con i compagni. Include il "Podio Virtuale" generato automaticamente ogni settimana.</p>
                        </li>
                        <li class="list-group-item">
                            <h5 class="fw-bold"><i class="bi bi-shop me-2"></i>Attrezzatura (Scarpe)</h5>
                            <p>Monitora i km delle tue scarpe importate da Strava. Il sistema ti aiuta a capire quando √® ora di cambiarle.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 3. Privacy & Impostazioni -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingPrivacy">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePrivacy" aria-expanded="false" aria-controls="collapsePrivacy">
                    <i class="bi bi-shield-lock me-2"></i> Privacy & Impostazioni
                </button>
            </h2>
            <div id="collapsePrivacy" class="accordion-collapse collapse" aria-labelledby="headingPrivacy" data-bs-parent="#guideAccordion">
                <div class="accordion-body">
                    <p>Gestisci la visibilit√† dei tuoi dati nella pagina <strong>Impostazioni</strong>:</p>
                    <ul>
                        <li><strong>Dashboard Pubblica:</strong> Se attivo, permette agli altri membri del team di vedere i tuoi grafici dettagliati. Altrimenti, vedranno solo i dati aggregati nel riepilogo.</li>
                        <li><strong>Condividi Metriche:</strong> Puoi decidere se mostrare o nascondere il tuo VO2max e gli indici ITRA/UTMB nella tabella riepilogativa.</li>
                        <li><strong>Mostra Peso:</strong> Scegli se rendere visibile il tuo peso agli altri utenti (utile per calcoli W/kg).</li>
                        <li><strong>Attivit√† Private:</strong> Puoi autorizzare l'importazione delle attivit√† segnate come "Private" su Strava.</li>
                        <li><strong>Escludimi da Statistiche Coach:</strong> Se attivo, i tuoi dati non verranno conteggiati nelle medie di squadra visualizzate dallo staff.</li>
                    </ul>
                </div>
            </div>
        </div>

    </div>
    
    <div class="mt-5 text-center text-muted small">
        <a href="{% url 'home' %}" class="btn btn-outline-secondary"><i class="bi bi-arrow-left me-2"></i>Torna alla Dashboard</a>
    </div>
</div>
{% endblock %}